# -*- Mode: YAML; indent-tabs-mode: nil; tab-width: 2 -*-
---
app-id: org.gnome.DejaDupDevel
runtime: org.gnome.Platform
runtime-version: '3.30'
sdk: org.gnome.Sdk
command: deja-dup

finish-args:
  - --socket=wayland

  - --socket=x11
  - --share=ipc

  - --filesystem=host

  - --share=network
  - --system-talk-name=org.freedesktop.NetworkManager

  - --talk-name=org.gtk.vfs
  - --talk-name=org.gtk.vfs.*

  - --talk-name=org.freedesktop.secrets
  - --talk-name=org.gnome.OnlineAccounts

  - --filesystem=xdg-run/dconf
  - --filesystem=~/.config/dconf:ro
  - --talk-name=ca.desrt.dconf
  - --env=DCONF_USER_CONFIG_DIR=.config/dconf

modules:
  - name: librest
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/librest.git
        tag: 0.8.1

  - name: gnome-online-accounts
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/gnome-online-accounts.git
        tag: 3.30.1


  - name: libgpg-error
    config-opts:
      - --disable-doc
    sources:
      - type: git
        url: https://dev.gnupg.org/source/libgpg-error.git
        tag: libgpg-error-1.34


  - name: librsync
    buildsystem: cmake
    sources:
      - type: git
        url: https://github.com/librsync/librsync
        tag: v2.0.2

  - name: setuptools-scm
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/pypa/setuptools_scm
        tag: v3.2.0

  - name: pytest
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/pytest-dev/pytest
        tag: 3.9.1

  - name: pytest-runner
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/pytest-dev/pytest-runner
        tag: '5.1'

  - name: python-six
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/benjaminp/six
        tag: 1.12.0

  - name: python-monotonic
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/atdt/monotonic
        tag: '1.5'

  - name: python-fasteners
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/harlowja/fasteners
        tag: 0.14.1

  - name: duplicity
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --prefix /app
    sources:
      - type: archive
        url: https://launchpad.net/duplicity/0.8-series/0.8.00/+download/duplicity-0.8.00.tar.gz
        md5: e6a48e847e1778548133bc3723548723


  - name: pycairo
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/pygobject/pycairo
        tag: v1.18.0

  - name: pygobject
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/pygobject/
        tag: 3.30.4


  - name: python-boto
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/boto/boto
        tag: 2.49.0


  - name: python-pbr
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --prefix /app
    sources:
      - type: git
        url: https://github.com/openstack-dev/pbr
        tag: 5.1.1

  - name: python-certifi
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/certifi/python-certifi
        tag: 2018.11.29

  - name: python-requests
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: archive
        url: https://pypi.python.org/packages/b0/e1/eab4fc3752e3d240468a8c0b284607899d2fbfb236a56b7377a329aa8d09/requests-2.18.4.tar.gz
        sha256: 9c443e7324ba5b85070c4a818ade28bfabedf16ea10206da1132edaa6dda237e

  - name: python-swiftclient
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --prefix /app
    sources:
      - type: git
        url: https://github.com/openstack/python-swiftclient
        tag: 3.6.0


  - name: pyyaml
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --prefix /app
    sources:
      - type: git
        url: https://github.com/yaml/pyyaml
        tag: '5.1'

  - name: pyasn1
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --prefix /app
    sources:
      - type: git
        url: https://github.com/etingof/pyasn1
        tag: v0.4.5

  - name: rsa
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/sybrenstuvel/python-rsa
        tag: version-4.0

  - name: oauth2client
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/googleapis/oauth2client
        tag: v4.1.3

  - name: pydrive
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/gsuitedevs/PyDrive
        tag: 1.3.1


  - name: mock
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --prefix /app
    sources:
      - type: git
        url: https://github.com/testing-cabal/mock
        tag: 2.0.0

  - name: keyring
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/jaraco/keyring
        tag: 15.2.0

  - name: pyrax
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --single-version-externally-managed --root=/ --prefix /app
    sources:
      - type: git
        url: https://github.com/pycontribs/pyrax
        tag: v1.9.8


  - name: deja-dup
    buildsystem: meson
    builddir: true
    config-opts:
      - -Dprofile=Devel
    sources:
      - type: git
        url: ..
